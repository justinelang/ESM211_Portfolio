---
title: "Habitat Range Part 2: Kernels"
author: "Justine Lang"
date: "2024-01-30"
output: 
  html_document: 
    code_folding: show
---

```{r setup, echo = TRUE, warning = FALSE, message = FALSE, results = FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, results = FALSE)

library(tidyverse)
library(here)
library(janitor)
library(adehabitatHR)
library(sp)
```

```{r}
### Let's start as we did before: read in the csv and filter to 6 elk from the NER

elk <- read_csv(here("elk_collar.csv"))

elk <- elk %>% 
  mutate_at("id", as.character)

elk_ner <- elk %>% 
  filter(feedground == "National_Elk_Refuge") %>% 
  filter(id %in% c("631", "632", "633", "634", "635", "636"))
```

```{r}
### Same process creating your SpatialPointsDataFrame

elk_ner <- elk_ner[!is.na(elk_ner$x) & !is.na(elk_ner$y),]

elk.sp <- elk_ner[, c("id", "x", "y")] 

coordinates(elk.sp) <- c("x", "y")

proj4string(elk.sp) <- CRS("+proj=utm +zone=12 +datum=WGS84 +units=m +no_defs")
```

```{r}
kernel.ref <- kernelUD(elk.sp, h = "href")  # href = the reference bandwidth
image(kernel.ref) # plot
```

```{r}
kernel.ref[[1]]@h # The smoothing factor is stored for each animal in the "h" slot
```

```{r}
kernel.lscv <- kernelUD(elk.sp, h = "LSCV") # Least square cross validation
```

```{r}
image(kernel.lscv) # plot
```

```{r}
plotLSCV(kernel.lscv) # Look for a dip
```

```{r}
elk.kernel.poly <- getverticeshr(kernel.ref, percent = 95) 
print(elk.kernel.poly)  # returns the area of each polygon
```

```{r}
color <- rep("white", nrow(elk.sp@data))
  color[(elk.sp@data$id == "632")] <- "red"
  color[(elk.sp@data$id == "633")] <- "green"
  color[(elk.sp@data$id == "634")] <- "blue"
  color[(elk.sp@data$id == "635")] <- "orange"
  color[(elk.sp@data$id == "636")] <- "yellow"
plot(elk.kernel.poly, col = elk.kernel.poly@data$id)
  plot(elk.sp, add = TRUE, col = color, pch = 21)
```

Like with the MCPs, you can repeat this process with the fed elk herds instead of the individual animals, though your computer may get a bit of a workout attempting to create kernels for more than one or two herds at a time, especially through the LSCV method. For the sake of time, we'll skip this today, but if you happen to have time to kill, feel free to go for it!





